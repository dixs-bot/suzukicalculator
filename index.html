<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulasi Angsuran Mobil Responsive</title>
    <style>
        /* ==================================== */
        /* CSS UNTUK RESPONSIVITAS & TAMPILAN */
        /* ==================================== */
        :root {
            --primary-color: #007bff;
            --secondary-color: #28a745;
            --background-color: #f8f9fa;
            --card-background: #ffffff;
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 10px;
        }

        .card {
            background: var(--card-background);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border-top: 5px solid var(--secondary-color);
        }

        /* Form Controls */
        label {
            display: block;
            margin-top: 15px;
            margin-bottom: 5px;
            font-weight: 600;
        }

        select, input[type="number"], input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 16px;
        }
        
        /* Tenor Buttons */
        .tenor-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap; 
            margin-top: 10px;
        }

        .tenor-options button {
            flex-grow: 1; 
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background-color: #e9ecef;
            color: #495057;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        .tenor-options button.active, .tenor-options button:hover {
            background-color: var(--primary-color);
            color: white;
        }

        /* Hasil Perhitungan */
        .result {
            margin-top: 25px;
            padding: 20px;
            background-color: #e2f0ff;
            border: 1px solid var(--primary-color);
            border-radius: 8px;
        }

        .result h3 {
            margin-top: 0;
            color: var(--primary-color);
        }

        .result p {
            font-size: 1.1em;
            margin: 5px 0;
        }

        .highlight {
            font-weight: bold;
            color: var(--secondary-color);
            font-size: 1.2em;
        }

        /* Mode Toggle */
        .mode-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .mode-toggle button {
            padding: 10px 15px;
            border: 1px solid var(--primary-color);
            background: none;
            color: var(--primary-color);
            cursor: pointer;
            transition: all 0.3s;
        }

        .mode-toggle button.active {
            background-color: var(--primary-color);
            color: white;
        }
        
        .mode-toggle button:first-child { border-radius: 8px 0 0 8px; }
        .mode-toggle button:last-child { border-radius: 0 8px 8px 0; }
        
        /* Utility */
        .hidden { display: none; }
        
        /* Media Query untuk Mobile */
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            h1 {
                font-size: 1.5em;
            }
            .tenor-options {
                gap: 5px;
            }
            .tenor-options button {
                padding: 8px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ðŸš˜ Simulasi Angsuran Mobil</h1>

    <div class="mode-toggle">
        <button id="btn-mode-standard" class="active" onclick="changeMode('standard')">Mode Angsuran DP</button>
        <button id="btn-mode-reverse" onclick="changeMode('reverse')">Mode Request Angsuran</button>
    </div>

    <div class="card">
        <h2>Detail Mobil & Tenor</h2>
        <label for="mobil_select">Pilih Mobil:</label>
        <select id="mobil_select" onchange="updateOtrDisplay()">
            </select>

        <label for="display_otr">Harga OTR (Rp):</label>
        <input type="text" id="display_otr" value="0" readonly>
        
        <label for="display_bunga">Bunga Flat Tahunan (%): <span id="bunga_display">11%</span></label>
        <input type="number" id="input_bunga" value="11" min="0.1" readonly> <label>Pilih Tenor (Tahun):</label>
        <div class="tenor-options" id="tenor_options">
            <button onclick="setTenor(1)">1 Tahun (7%)</button>
            <button onclick="setTenor(2)">2 Tahun (8%)</button>
            <button onclick="setTenor(3)">3 Tahun (9%)</button>
            <button onclick="setTenor(4)">4 Tahun (10%)</button>
            <button class="active" onclick="setTenor(5)">5 Tahun (11%)</button>
        </div>
    </div>
    
    <div class="card">
        <h2>Biaya Administrasi (Dibebankan ke Angsuran)</h2>
        <label for="biaya_provisi">Provisi (Rp):</label>
        <input type="number" id="biaya_provisi" value="4300000" min="0" oninput="hitungSimulasi()">

        <label for="biaya_admin">Biaya Admin (Rp):</label>
        <input type="number" id="biaya_admin" value="2000000" min="0" oninput="hitungSimulasi()">

        <label for="biaya_asuransi">Biaya Asuransi (Rp):</label>
        <input type="number" id="biaya_asuransi" value="3000000" min="0" oninput="hitungSimulasi()">
    </div>

    <div class="card" id="input-standard-card">
        <h2>Input DP & Diskon</h2>
        
        <label for="input_dp">DP Request Konsumen (Rp):</label>
        <input type="number" id="input_dp" value="0" min="0" oninput="hitungSimulasi()">

        <label for="input_diskon">Diskon Dealer Manual (Rp):</label>
        <input type="number" id="input_diskon" value="0" min="0" oninput="hitungSimulasi()">
    </div>

    <div class="card hidden" id="input-reverse-card">
        <h2>Input Angsuran Request</h2>
        
        <label for="request_angsuran">Kesanggupan Angsuran Bulanan (Rp):</label>
        <input type="number" id="request_angsuran" value="4000000" min="100000" oninput="hitungSimulasi()">

        <label for="reverse_dp_persen">Target DP Minimal (Persen OTR):</label>
        <input type="number" id="reverse_dp_persen" value="20" min="0" max="100" placeholder="Minimal DP 20%" oninput="hitungSimulasi()">
    </div>


    <div class="card result">
        <h3>Hasil Simulasi</h3>
        <p>Harga Bersih (OTR - Diskon): <span id="hasil_harga_bersih" class="highlight">Rp 0</span></p>
        <hr>
        
        <div id="result-standard-output">
            <p>DP Dibayarkan: <span id="hasil_dp_dibayar" class="highlight">Rp 0</span></p>
            <p>Pokok Pinjaman: <span id="hasil_pokok_pinjaman" class="highlight">Rp 0</span></p>
            <p>Biaya Tambahan Total: <span id="hasil_biaya_tambahan" class="highlight">Rp 0</span></p>
            <hr>
            <p>Angsuran Pokok + Bunga: <span id="hasil_angsuran_pokok_bunga" class="highlight">Rp 0</span></p>
            <p>Angsuran Biaya Tambahan: <span id="hasil_angsuran_biaya" class="highlight">Rp 0</span></p>
            <p>Angsuran Bulanan TOTAL: <span id="hasil_angsuran_bulanan" class="highlight">Rp 0</span></p>
        </div>
        
        <div id="result-reverse-output" class="hidden">
            <p>Angsuran Request Bulanan: <span id="reverse_angsuran_request" class="highlight">Rp 0</span></p>
            <p>Total DP Wajib Dibayar: <span id="reverse_dp_wajib" class="highlight">Rp 0</span></p>
            <p>DP Minimum OTR (<span id="reverse_dp_persen_output">20%</span>): <span id="reverse_dp_minimal_otr" class="highlight">Rp 0</span></p>
        </div>
    </div>
</div>

<script>
    // ====================================
    // 1. DATA MOBIL (MUDAH DI EDIT)
    // ====================================
    const DATA_MOBIL = [
        { id: 1, nama: "Suzuki XL7 Tipe Zeta", otr: 350000000 },
        { id: 2, nama: "Toyota Avanza 1.5 G", otr: 280000000 },
        { id: 3, nama: "Honda Brio RS", otr: 250000000 },
        { id: 4, nama: "Mitsubishi Xpander Ultimate", otr: 320000000 },
        { id: 5, nama: "Pilih Mobil Lain...", otr: 0 }, 
    ];
    
    // 2. DATA BUNGA BERDASARKAN TENOR (BARU)
    const TENOR_CONFIG = {
        1: 7,  // 1 Tahun, Bunga 7%
        2: 8,  // 2 Tahun, Bunga 8%
        3: 9,  // 3 Tahun, Bunga 9%
        4: 10, // 4 Tahun, Bunga 10%
        5: 11  // 5 Tahun, Bunga 11%
    };

    // ====================================
    // 3. FUNGSI UTILITY
    // ====================================
    const formatRupiah = (angka) => {
        const num = Math.round(angka);
        return new Intl.NumberFormat('id-ID', {
            style: 'currency',
            currency: 'IDR',
            minimumFractionDigits: 0
        }).format(num);
    };

    /**
     * Hitung Angsuran Flat Rate Bulanan
     */
    const hitungAngsuranFlat = (pokokPinjaman, tenorBulan, bungaTahunanPersen) => {
        if (tenorBulan <= 0) return 0;
        const bungaTahunan = bungaTahunanPersen / 100;
        const totalBunga = pokokPinjaman * bungaTahunan * (tenorBulan / 12);
        const totalTagihan = pokokPinjaman + totalBunga;
        return totalTagihan / tenorBulan;
    };
    
    /**
     * Hitung Pokok Pinjaman Maksimal dari Angsuran Request (Reverse)
     */
    const hitungPokokPinjamanMaks = (angsuranRequest, tenorBulan, bungaTahunanPersen) => {
        const B = bungaTahunanPersen / 100;
        const T = tenorBulan;
        
        // P = (A * T) / (1 + B * (T/12))
        let pokokPinjamanMaks = 0;
        if (angsuranRequest > 0 && T > 0) {
            pokokPinjamanMaks = (angsuranRequest * T) / (1 + (B * (T / 12)));
        }
        return pokokPinjamanMaks;
    }

    // ====================================
    // 4. FUNGSI START & TENOR
    // ====================================
    let currentTenorTahun = 5;
    let currentMode = 'standard';

    document.addEventListener('DOMContentLoaded', () => {
        populateMobilOptions();
        setTenor(currentTenorTahun);
        changeMode(currentMode);
    });

    function populateMobilOptions() {
        // ... (fungsi sama seperti sebelumnya) ...
        const select = document.getElementById('mobil_select');
        DATA_MOBIL.forEach(mobil => {
            const option = document.createElement('option');
            option.value = mobil.id;
            option.textContent = `${mobil.nama} (OTR: ${formatRupiah(mobil.otr)})`;
            select.appendChild(option);
        });
        select.value = DATA_MOBIL[0].id;
        updateOtrDisplay();
    }

    function updateOtrDisplay() {
        // ... (fungsi sama seperti sebelumnya) ...
        const selectedId = parseInt(document.getElementById('mobil_select').value);
        const mobil = DATA_MOBIL.find(m => m.id === selectedId);
        document.getElementById('display_otr').value = formatRupiah(mobil ? mobil.otr : 0);
        hitungSimulasi();
    }

    // Mengatur tenor yang dipilih dan bunga otomatis
    function setTenor(tahun) {
        currentTenorTahun = tahun;
        
        // Set Bunga Otomatis
        const bunga = TENOR_CONFIG[tahun] || TENOR_CONFIG[5]; // Ambil bunga dari config, default ke 5 tahun jika tidak ada
        document.getElementById('input_bunga').value = bunga;
        document.getElementById('bunga_display').textContent = bunga + '%';
        
        // Update tampilan tombol aktif
        const buttons = document.querySelectorAll('.tenor-options button');
        buttons.forEach(btn => {
            btn.classList.remove('active');
            if (btn.textContent.includes(`${tahun} Tahun`)) {
                btn.classList.add('active');
            }
        });

        hitungSimulasi();
    }

    function changeMode(mode) {
        // ... (fungsi sama seperti sebelumnya) ...
        currentMode = mode;
        const standardCard = document.getElementById('input-standard-card');
        const reverseCard = document.getElementById('input-reverse-card');
        const standardOutput = document.getElementById('result-standard-output');
        const reverseOutput = document.getElementById('result-reverse-output');
        
        document.getElementById('btn-mode-standard').classList.remove('active');
        document.getElementById('btn-mode-reverse').classList.remove('active');

        if (mode === 'standard') {
            standardCard.classList.remove('hidden');
            reverseCard.classList.add('hidden');
            standardOutput.classList.remove('hidden');
            reverseOutput.classList.add('hidden');
            document.getElementById('btn-mode-standard').classList.add('active');
        } else {
            standardCard.classList.add('hidden');
            reverseCard.classList.remove('hidden');
            standardOutput.classList.add('hidden');
            reverseOutput.classList.remove('hidden');
            document.getElementById('btn-mode-reverse').classList.add('active');
        }
        hitungSimulasi();
    }

    // ====================================
    // 5. LOGIKA PERHITUNGAN UTAMA
    // ====================================
    function hitungSimulasi() {
        // --- Ambil Data Dasar ---
        const selectedId = parseInt(document.getElementById('mobil_select').value);
        const mobil = DATA_MOBIL.find(m => m.id === selectedId);
        const hargaOtr = mobil ? mobil.otr : 0;
        
        const bungaTahunan = parseFloat(document.getElementById('input_bunga').value) || 0;
        const tenorBulan = currentTenorTahun * 12;
        
        const diskon = parseFloat(document.getElementById('input_diskon').value) || 0;
        
        // Biaya Tambahan Baru
        const biayaProvisi = parseFloat(document.getElementById('biaya_provisi').value) || 0;
        const biayaAdmin = parseFloat(document.getElementById('biaya_admin').value) || 0;
        const biayaAsuransi = parseFloat(document.getElementById('biaya_asuransi').value) || 0;
        const totalBiayaTambahan = biayaProvisi + biayaAdmin + biayaAsuransi;
        
        // Angsuran Biaya Tambahan per bulan
        const angsuranBiaya = totalBiayaTambahan / tenorBulan;

        // Harga Bersih
        const hargaBersih = Math.max(0, hargaOtr - diskon);
        document.getElementById('hasil_harga_bersih').textContent = formatRupiah(hargaBersih);
        document.getElementById('hasil_biaya_tambahan').textContent = formatRupiah(totalBiayaTambahan);
        document.getElementById('hasil_angsuran_biaya').textContent = formatRupiah(angsuranBiaya);


        if (currentMode === 'standard') {
            // --- MODE STANDARD (DP -> Angsuran) ---
            const dpRequest = parseFloat(document.getElementById('input_dp').value) || 0;
            
            // Hitung Pokok Pinjaman
            const pokokPinjaman = Math.max(0, hargaBersih - dpRequest);
            
            // Hitung Angsuran Pokok + Bunga
            const angsuranPokokBunga = hitungAngsuranFlat(pokokPinjaman, tenorBulan, bungaTahunan);
            
            // Hitung Angsuran Total
            const angsuranTotal = angsuranPokokBunga + angsuranBiaya;

            // Tampilkan Hasil
            document.getElementById('hasil_dp_dibayar').textContent = formatRupiah(dpRequest);
            document.getElementById('hasil_pokok_pinjaman').textContent = formatRupiah(pokokPinjaman);
            document.getElementById('hasil_angsuran_pokok_bunga').textContent = formatRupiah(angsuranPokokBunga);
            document.getElementById('hasil_angsuran_bulanan').textContent = formatRupiah(angsuranTotal);

        } else { // currentMode === 'reverse'
            // --- MODE REVERSE (Angsuran -> DP) ---
            
            // Angsuran request harus dikurangi Angsuran Biaya Tambahan untuk mendapatkan Angsuran Pokok+Bunga
            const angsuranRequestTotal = parseFloat(document.getElementById('request_angsuran').value) || 0;
            const angsuranRequestPokokBunga = Math.max(0, angsuranRequestTotal - angsuranBiaya);
            
            const targetDpPersen = parseFloat(document.getElementById('reverse_dp_persen').value) || 0;

            // 1. Hitung Pokok Pinjaman Maksimal dari Angsuran Pokok+Bunga Request
            const pokokPinjamanMaks = hitungPokokPinjamanMaks(angsuranRequestPokokBunga, tenorBulan, bungaTahunan);

            // 2. Hitung DP Wajib Dibayar
            const dpWajib = Math.max(0, hargaBersih - pokokPinjamanMaks);

            // 3. Hitung DP Minimal OTR
            const dpMinimalOtr = hargaOtr * (targetDpPersen / 100);

            // 4. Tampilkan Hasil
            document.getElementById('reverse_angsuran_request').textContent = formatRupiah(angsuranRequestTotal);
            
            // DP Final adalah nilai yang tertinggi antara DP Wajib dan DP Minimal OTR
            const dpFinal = Math.max(dpWajib, dpMinimalOtr);
            
            document.getElementById('reverse_dp_wajib').textContent = formatRupiah(dpFinal);
            document.getElementById('reverse_dp_minimal_otr').textContent = formatRupiah(dpMinimalOtr);
            document.getElementById('reverse_dp_persen_output').textContent = targetDpPersen + '%';
        }
    }
</script>

</body>
</html>
