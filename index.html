<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulasi Angsuran Mobil Responsive & DP Paket Leasing</title>
    <style>
        /* ==================================== */
        /* CSS UNTUK RESPONSIVITAS & TAMPILAN */
        /* ==================================== */
        :root {
            --primary-color: #007bff;
            --secondary-color: #28a745;
            --background-color: #f8f9fa;
            --card-background: #ffffff;
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 10px;
        }

        .card {
            background: var(--card-background);
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border-top: 5px solid var(--secondary-color);
        }
        
        /* Form Controls */
        label {
            display: block;
            margin-top: 15px;
            margin-bottom: 5px;
            font-weight: 600;
        }

        select, input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 16px;
        }
        
        input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 16px;
        }

        /* Mode Tampilan Utama (Baru) */
        .main-mode-toggle {
            display: flex;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .main-mode-toggle button {
            flex-grow: 1;
            padding: 15px 10px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            background-color: #e9ecef;
            color: #495057;
        }
        
        .main-mode-toggle button.active {
            background-color: var(--secondary-color);
            color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* Tenor Buttons */
        .tenor-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap; 
            margin-top: 10px;
        }

        .tenor-options button {
            flex-grow: 1; 
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background-color: #e9ecef;
            color: #495057;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        .tenor-options button.active, .tenor-options button:hover {
            background-color: var(--primary-color);
            color: white;
        }

        /* Hasil Perhitungan */
        .result {
            margin-top: 25px;
            padding: 20px;
            background-color: #e2f0ff;
            border: 1px solid var(--primary-color);
            border-radius: 8px;
        }

        .result h3 {
            margin-top: 0;
            color: var(--primary-color);
        }

        .result p {
            font-size: 1.1em;
            margin: 5px 0;
        }

        .highlight {
            font-weight: bold;
            color: var(--secondary-color);
            font-size: 1.2em;
        }

        /* Tabel DP Paket */
        .dp-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            overflow-x: auto; 
            display: block;
            white-space: nowrap;
        }

        .dp-table th, .dp-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            font-size: 0.85em;
        }

        .dp-table th {
            background-color: var(--primary-color);
            color: white;
            font-size: 0.9em;
        }
        
        .dp-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        .dp-table .tenor-header {
            background-color: #0056b3;
            color: white;
        }
        
        .hidden { display: none; }
        
        @media (max-width: 600px) {
            .container { padding: 10px; }
            h1 { font-size: 1.5em; }
            .tenor-options { gap: 5px; }
            .tenor-options button { padding: 8px; font-size: 0.9em; }
            .dp-table th, .dp-table td { padding: 6px; font-size: 0.75em; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ðŸš˜ Simulasi Angsuran Mobil</h1>

    <div class="card">
        <h2>Pilih Unit Mobil</h2>
        <label for="mobil_select">Pilih Mobil:</label>
        <select id="mobil_select" onchange="updateOtrDisplay(); generateDpPacketTable()">
            </select>

        <label for="display_otr">Harga OTR:</label>
        <input type="text" id="display_otr" value="0" readonly>
    </div>
    
    <div class="card">
        <h2>Detail Tenor & Biaya Umum</h2>
        
        <label for="display_bunga">Bunga Flat Tahunan (%): <span id="bunga_display">11%</span></label>
        <input type="number" id="input_bunga" value="11" min="0.1" readonly>

        <label>Pilih Tenor (Tahun):</label>
        <div class="tenor-options" id="tenor_options">
            <button onclick="setTenor(1)">1 Tahun (7%)</button>
            <button onclick="setTenor(2)">2 Tahun (8%)</button>
            <button onclick="setTenor(3)">3 Tahun (9%)</button>
            <button onclick="setTenor(4)">4 Tahun (10%)</button>
            <button class="active" onclick="setTenor(5)">5 Tahun (11%)</button>
        </div>
    </div>
    
    <div class="card">
        <h2>Biaya Administrasi (Dibebankan ke Angsuran)</h2>
        <label for="biaya_provisi">Provisi (Rp):</label>
        <input type="text" id="biaya_provisi" value="4.300.000" oninput="formatInputRupiah(this); generateDpPacketTable()">

        <label for="biaya_admin">Biaya Admin (Rp):</label>
        <input type="text" id="biaya_admin" value="2.000.000" oninput="formatInputRupiah(this); generateDpPacketTable()">

        <label for="biaya_asuransi">Biaya Asuransi (Rp):</label>
        <input type="text" id="biaya_asuransi" value="3.000.000" oninput="formatInputRupiah(this); generateDpPacketTable()">
    </div>
    
    <div class="main-mode-toggle">
        <button id="btn-mode-simulasi" class="active" onclick="changeDisplayMode('simulasi')">ðŸ’µ Simulasi Angsuran Manual</button>
        <button id="btn-mode-dp-paket" onclick="changeDisplayMode('dp-paket')">ðŸ“‹ Tabel DP Paket Leasing</button>
    </div>
    
    <div id="simulasi-manual-container">
        <div class="mode-toggle">
            <button id="btn-mode-standard" class="active" onclick="changeMode('standard')">Mode Angsuran DP</button>
            <button id="btn-mode-reverse" onclick="changeMode('reverse')">Mode Request Angsuran</button>
        </div>

        <div class="card" id="input-standard-card">
            <h2>Input DP & Diskon</h2>
            
            <label for="input_dp">DP Request Konsumen (Rp):</label>
            <input type="text" id="input_dp" value="0" oninput="formatInputRupiah(this)">

            <label for="input_diskon">Diskon Dealer Manual (Rp):</label>
            <input type="text" id="input_diskon" value="0" oninput="formatInputRupiah(this)">
        </div>

        <div class="card hidden" id="input-reverse-card">
            <h2>Input Angsuran Request</h2>
            
            <label for="request_angsuran">Kesanggupan Angsuran Bulanan (Rp):</label>
            <input type="text" id="request_angsuran" value="4.000.000" oninput="formatInputRupiah(this)">

            <label for="reverse_dp_persen">Target DP Minimal (Persen OTR):</label>
            <input type="number" id="reverse_dp_persen" value="20" min="0" max="100" placeholder="Minimal DP 20%" oninput="hitungSimulasi()">
        </div>

        <div class="card result">
            <h3>Hasil Simulasi</h3>
            <p>Harga Bersih (OTR - Diskon): <span id="hasil_harga_bersih" class="highlight">Rp 0</span></p>
            <hr>
            
            <div id="result-standard-output">
                <p>DP Dibayarkan: <span id="hasil_dp_dibayar" class="highlight">Rp 0</span></p>
                <p>Pokok Pinjaman: <span id="hasil_pokok_pinjaman" class="highlight">Rp 0</span></p>
                <p>Biaya Tambahan Total: <span id="hasil_biaya_tambahan" class="highlight">Rp 0</span></p>
                <hr>
                <p>Angsuran Pokok + Bunga: <span id="hasil_angsuran_pokok_bunga" class="highlight">Rp 0</span></p>
                <p>Angsuran Biaya Tambahan: <span id="hasil_angsuran_biaya" class="highlight">Rp 0</span></p>
                <p>Angsuran Bulanan TOTAL: <span id="hasil_angsuran_bulanan" class="highlight">Rp 0</span></p>
            </div>
            
            <div id="result-reverse-output" class="hidden">
                <p>Angsuran Request Bulanan: <span id="reverse_angsuran_request" class="highlight">Rp 0</span></p>
                <p>Total DP Wajib Dibayar: <span id="reverse_dp_wajib" class="highlight">Rp 0</span></p>
                <p>DP Minimum OTR (<span id="reverse_dp_persen_output">20%</span>): <span id="reverse_dp_minimal_otr" class="highlight">Rp 0</span></p>
            </div>
        </div>
    </div>
    
    <div id="dp-paket-container" class="hidden card">
        <h2>ðŸ“‹ Tabel Perbandingan DP Paket & Angsuran</h2>
        <div id="dp_paket_content">
            </div>
    </div>
</div>

<script>
    // ====================================
    // 1. DATA MOBIL & TENOR
    // ====================================
    const DATA_MOBIL = [
        { id: 1, nama: "Suzuki XL7 Tipe Zeta", otr: 350000000 },
        { id: 2, nama: "Toyota Avanza 1.5 G", otr: 280000000 },
        { id: 3, nama: "Honda Brio RS", otr: 250000000 },
        { id: 4, nama: "Mitsubishi Xpander Ultimate", otr: 320000000 },
        { id: 5, nama: "Pilih Mobil Lain...", otr: 0 }, 
    ];
    
    const TENOR_CONFIG = {
        1: 7, 2: 8, 3: 9, 4: 10, 5: 11
    };
    
    const DP_PAKET_CONFIG = [
        { nama: "Adira Finance", persentase: [10, 15, 20, 30, 50] }, 
        { nama: "Mandiri Tunas Finance (MTF)", persentase: [15, 25, 35, 45] },
        { nama: "BCA Finance", persentase: [10, 20, 30, 40] }
    ];

    // ====================================
    // 2. FUNGSI UTILITY
    // ====================================
    const formatAngkaRupiah = (angka) => {
        const num = Math.round(angka);
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    };

    const formatRupiahDisplay = (angka) => {
        const num = Math.round(angka);
        return new Intl.NumberFormat('id-ID', {
            style: 'currency',
            currency: 'IDR',
            minimumFractionDigits: 0
        }).format(num);
    };
    
    const cleanRupiahValue = (rupiahString) => {
        if (!rupiahString) return 0;
        return parseFloat(rupiahString.toString().replace(/\./g, ''));
    };

    function formatInputRupiah(inputElement) {
        let value = inputElement.value.replace(/\./g, '');
        
        if (value && !isNaN(value)) {
            inputElement.value = formatAngkaRupiah(value);
        } else if (value.length > 0) {
            inputElement.value = '';
        }
        
        // Panggil fungsi yang diperlukan setelah input berubah
        if (['biaya_provisi', 'biaya_admin', 'biaya_asuransi', 'input_diskon'].includes(inputElement.id)) {
            generateDpPacketTable();
            hitungSimulasi(); // Juga dipanggil untuk mengupdate Harga Bersih di mode manual
        } else {
            hitungSimulasi();
        }
    }
    
    const hitungAngsuranFlat = (pokokPinjaman, tenorBulan, bungaTahunanPersen) => {
        if (tenorBulan <= 0) return 0;
        const bungaTahunan = bungaTahunanPersen / 100;
        const totalBunga = pokokPinjaman * bungaTahunan * (tenorBulan / 12);
        const totalTagihan = pokokPinjaman + totalBunga;
        return totalTagihan / tenorBulan;
    };

    const hitungPokokPinjamanMaks = (angsuranRequest, tenorBulan, bungaTahunanPersen) => {
        const B = bungaTahunanPersen / 100;
        const T = tenorBulan;
        
        let pokokPinjamanMaks = 0;
        if (angsuranRequest > 0 && T > 0) {
            pokokPinjamanMaks = (angsuranRequest * T) / (1 + (B * (T / 12)));
        }
        return pokokPinjamanMaks;
    }

    // ====================================
    // 3. FUNGSI UTAMA GENERATE DP PAKET
    // ====================================
    function generateDpPacketTable() {
        const selectedId = parseInt(document.getElementById('mobil_select').value);
        const mobil = DATA_MOBIL.find(m => m.id === selectedId);
        const hargaOtr = mobil ? mobil.otr : 0;
        
        // Ambil Diskon dan Biaya Tambahan
        const diskon = cleanRupiahValue(document.getElementById('input_diskon').value) || 0; 
        const hargaBersih = Math.max(0, hargaOtr - diskon);

        const biayaProvisi = cleanRupiahValue(document.getElementById('biaya_provisi').value) || 0;
        const biayaAdmin = cleanRupiahValue(document.getElementById('biaya_admin').value) || 0;
        const biayaAsuransi = cleanRupiahValue(document.getElementById('biaya_asuransi').value) || 0;
        const totalBiayaTambahan = biayaProvisi + biayaAdmin + biayaAsuransi;
        
        const container = document.getElementById('dp_paket_content');
        let htmlContent = '';
        
        if (hargaOtr === 0) {
            container.innerHTML = `<p>Silakan pilih unit mobil terlebih dahulu.</p>`;
            return;
        }

        DP_PAKET_CONFIG.forEach(leasing => {
            let tableContent = '';
            
            let tenorHeader = '';
            for (let tenorTahun = 1; tenorTahun <= 5; tenorTahun++) {
                tenorHeader += `<th colspan="2" class="tenor-header">${tenorTahun} Tahun (${TENOR_CONFIG[tenorTahun]}%)</th>`;
            }

            let subHeader = '';
            for (let i = 0; i < 5; i++) {
                subHeader += `<th>TDP</th><th>Angs.</th>`;
            }
            
            leasing.persentase.forEach(persen => {
                const dpNominal = hargaOtr * (persen / 100);
                
                let dataRows = '';
                for (let tenorTahun = 1; tenorTahun <= 5; tenorTahun++) {
                    const tenorBulan = tenorTahun * 12;
                    const bunga = TENOR_CONFIG[tenorTahun];
                    
                    // TDP = DP Nominal + Total Biaya Tambahan (Provisi, Admin, Asuransi) + Angsuran Pertama (asumsi)
                    // Disini kita hanya menjumlahkan Biaya Tambahan karena Angsuran pertama adalah bagian dari Angsuran Total
                    const tdp = dpNominal + totalBiayaTambahan; 
                    
                    // Hitung Angsuran
                    const pokokPinjaman = Math.max(0, hargaBersih - dpNominal);
                    const angsuranPokokBunga = hitungAngsuranFlat(pokokPinjaman, tenorBulan, bunga);
                    const angsuranBiaya = totalBiayaTambahan / tenorBulan;
                    const angsuranTotal = angsuranPokokBunga + angsuranBiaya;

                    dataRows += `<td>${formatRupiahDisplay(tdp)}</td>`;
                    dataRows += `<td>${formatRupiahDisplay(angsuranTotal)}</td>`;
                }

                tableContent += `
                    <tr>
                        <td style="font-weight:bold;">${persen}% (${formatRupiahDisplay(dpNominal)})</td>
                        ${dataRows}
                    </tr>
                `;
            });

            htmlContent += `
                <h3 style="margin-top:20px; color: #007bff;">${leasing.nama}</h3>
                <div style="overflow-x: auto;">
                    <table class="dp-table">
                        <thead>
                            <tr>
                                <th rowspan="2">DP Paket (Nominal)</th>
                                ${tenorHeader}
                            </tr>
                            <tr>
                                ${subHeader}
                            </tr>
                        </thead>
                        <tbody>
                            ${tableContent}
                        </tbody>
                    </table>
                </div>
            `;
        });

        container.innerHTML = htmlContent;
    }

    // ====================================
    // 4. FUNGSI PENGATUR TAMPILAN
    // ====================================
    let currentTenorTahun = 5;
    let currentMode = 'standard'; // Mode Angsuran Manual (standard/reverse)

    function changeDisplayMode(mode) {
        const simulasiContainer = document.getElementById('simulasi-manual-container');
        const dpPaketContainer = document.getElementById('dp-paket-container');
        const btnSimulasi = document.getElementById('btn-mode-simulasi');
        const btnDpPaket = document.getElementById('btn-mode-dp-paket');

        btnSimulasi.classList.remove('active');
        btnDpPaket.classList.remove('active');

        if (mode === 'simulasi') {
            simulasiContainer.classList.remove('hidden');
            dpPaketContainer.classList.add('hidden');
            btnSimulasi.classList.add('active');
            hitungSimulasi(); // Pastikan hasil manual dihitung ulang
        } else if (mode === 'dp-paket') {
            simulasiContainer.classList.add('hidden');
            dpPaketContainer.classList.remove('hidden');
            btnDpPaket.classList.add('active');
            generateDpPacketTable(); // Pastikan tabel paket di-generate
        }
    }


    // ====================================
    // 5. FUNGSI START, TENOR & SIMULASI
    // ====================================
    document.addEventListener('DOMContentLoaded', () => {
        populateMobilOptions();
        
        document.querySelectorAll('input[type="text"]').forEach(input => {
            if (input.id !== 'display_otr') {
                 input.value = formatAngkaRupiah(cleanRupiahValue(input.value));
            }
        });
        setTenor(currentTenorTahun);
        changeMode(currentMode);
        changeDisplayMode('simulasi'); // Tampilkan mode simulasi secara default
    });

    function populateMobilOptions() {
        const select = document.getElementById('mobil_select');
        DATA_MOBIL.forEach(mobil => {
            const option = document.createElement('option');
            option.value = mobil.id;
            option.textContent = `${mobil.nama} (OTR: ${formatRupiahDisplay(mobil.otr)})`;
            select.appendChild(option);
        });
        select.value = DATA_MOBIL[0].id;
        updateOtrDisplay();
    }

    function updateOtrDisplay() {
        const selectedId = parseInt(document.getElementById('mobil_select').value);
        const mobil = DATA_MOBIL.find(m => m.id === selectedId);
        document.getElementById('display_otr').value = formatRupiahDisplay(mobil ? mobil.otr : 0);
        hitungSimulasi();
        generateDpPacketTable(); 
    }
    
    function setTenor(tahun) {
        currentTenorTahun = tahun;
        const bunga = TENOR_CONFIG[tahun] || TENOR_CONFIG[5];
        document.getElementById('input_bunga').value = bunga;
        document.getElementById('bunga_display').textContent = bunga + '%';
        
        const buttons = document.querySelectorAll('.tenor-options button');
        buttons.forEach(btn => {
            btn.classList.remove('active');
            if (btn.textContent.includes(`${tahun} Tahun`)) {
                btn.classList.add('active');
            }
        });
        // Panggil keduanya karena keduanya menggunakan data Tenor
        hitungSimulasi();
        generateDpPacketTable(); 
    }

    function changeMode(mode) {
        currentMode = mode;
        const standardCard = document.getElementById('input-standard-card');
        const reverseCard = document.getElementById('input-reverse-card');
        const standardOutput = document.getElementById('result-standard-output');
        const reverseOutput = document.getElementById('result-reverse-output');
        
        document.getElementById('btn-mode-standard').classList.remove('active');
        document.getElementById('btn-mode-reverse').classList.remove('active');

        if (mode === 'standard') {
            standardCard.classList.remove('hidden');
            reverseCard.classList.add('hidden');
            standardOutput.classList.remove('hidden');
            reverseOutput.classList.add('hidden');
            document.getElementById('btn-mode-standard').classList.add('active');
        } else {
            standardCard.classList.add('hidden');
            reverseCard.classList.remove('hidden');
            standardOutput.classList.add('hidden');
            reverseOutput.classList.remove('hidden');
            document.getElementById('btn-mode-reverse').classList.add('active');
        }
        hitungSimulasi();
    }
    
    // Fungsi hitungSimulasi (Logika inti tidak berubah)
    function hitungSimulasi() {
        const selectedId = parseInt(document.getElementById('mobil_select').value);
        const mobil = DATA_MOBIL.find(m => m.id === selectedId);
        const hargaOtr = mobil ? mobil.otr : 0;
        
        const bungaTahunan = parseFloat(document.getElementById('input_bunga').value) || 0;
        const tenorBulan = currentTenorTahun * 12;
        
        const diskon = cleanRupiahValue(document.getElementById('input_diskon').value);
        const biayaProvisi = cleanRupiahValue(document.getElementById('biaya_provisi').value);
        const biayaAdmin = cleanRupiahValue(document.getElementById('biaya_admin').value);
        const biayaAsuransi = cleanRupiahValue(document.getElementById('biaya_asuransi').value);
        
        const totalBiayaTambahan = biayaProvisi + biayaAdmin + biayaAsuransi;
        const angsuranBiaya = totalBiayaTambahan / tenorBulan;

        const hargaBersih = Math.max(0, hargaOtr - diskon);
        
        document.getElementById('hasil_harga_bersih').textContent = formatRupiahDisplay(hargaBersih);
        document.getElementById('hasil_biaya_tambahan').textContent = formatRupiahDisplay(totalBiayaTambahan);
        document.getElementById('hasil_angsuran_biaya').textContent = formatRupiahDisplay(angsuranBiaya);


        if (currentMode === 'standard') {
            const dpRequest = cleanRupiahValue(document.getElementById('input_dp').value);
            const pokokPinjaman = Math.max(0, hargaBersih - dpRequest);
            const angsuranPokokBunga = hitungAngsuranFlat(pokokPinjaman, tenorBulan, bungaTahunan);
            const angsuranTotal = angsuranPokokBunga + angsuranBiaya;

            document.getElementById('hasil_dp_dibayar').textContent = formatRupiahDisplay(dpRequest);
            document.getElementById('hasil_pokok_pinjaman').textContent = formatRupiahDisplay(pokokPinjaman);
            document.getElementById('hasil_angsuran_pokok_bunga').textContent = formatRupiahDisplay(angsuranPokokBunga);
            document.getElementById('hasil_angsuran_bulanan').textContent = formatRupiahDisplay(angsuranTotal);

        } else { // currentMode === 'reverse'
            const angsuranRequestTotal = cleanRupiahValue(document.getElementById('request_angsuran').value);
            const angsuranRequestPokokBunga = Math.max(0, angsuranRequestTotal - angsuranBiaya);
            const targetDpPersen = parseFloat(document.getElementById('reverse_dp_persen').value) || 0;

            const pokokPinjamanMaks = hitungPokokPinjamanMaks(angsuranRequestPokokBunga, tenorBulan, bungaTahunan);
            const dpWajib = Math.max(0, hargaBersih - pokokPinjamanMaks);

            const dpMinimalOtr = hargaOtr * (targetDpPersen / 100);

            document.getElementById('reverse_angsuran_request').textContent = formatRupiahDisplay(angsuranRequestTotal);
            
            const dpFinal = Math.max(dpWajib, dpMinimalOtr);
            
            document.getElementById('reverse_dp_wajib').textContent = formatRupiahDisplay(dpFinal);
            document.getElementById('reverse_dp_minimal_otr').textContent = formatRupiahDisplay(dpMinimalOtr);
            document.getElementById('reverse_dp_persen_output').textContent = targetDpPersen + '%';
        }
    }
</script>

</body>
</html>
